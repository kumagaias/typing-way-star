# 要件定義書

## 概要

Typing Way Starは、タイピングスキルと語学学習を同時に向上させるWebベースのドライブタイピングゲームです。プレイヤーは車を運転しながら道中で翻訳問題に回答し、制限時間内に8つのステージをクリアしてゴールを目指します。日本語と英語の相互翻訳を通じて、楽しみながら語学力とタイピング能力を向上させることができます。

## 要件

### 要件1

**ユーザーストーリー:** 語学学習者として、翻訳方向と難易度を選択したい。適切なスキルレベルで練習できるようにするため。

#### 受け入れ基準

1. WHEN ユーザーがゲームにアクセスした時 THEN システムは言語方向オプション（日本語→英語、英語→日本語）を表示する
2. WHEN ユーザーが言語方向を選択した時 THEN システムは難易度オプション（Easy、Medium、Hard）を表示する
3. WHEN ユーザーが難易度を選択した時 THEN システムはモードオプション（単語モード、会話モード）を表示する
4. IF ユーザーが前のステージを完了していない場合 THEN システムは解放済みステージのみアクセス可能にする

### 要件2

**ユーザーストーリー:** プレイヤーとして、8つの異なるステージを順番に進みたい。段階的な難易度と多様な環境を体験するため。

#### 受け入れ基準

1. WHEN ゲームが開始された時 THEN システムは8つのステージが一本道で繋がったルートマップを表示する
2. WHEN ステージが解放されている時 THEN システムはそれを明るく表示し選択可能にする
3. WHEN ステージがロックされている時 THEN システムはそれを暗く表示しロックアイコンを付ける
4. WHEN ステージが完了した時 THEN システムはチェックマークやトロフィーアイコンを表示する
5. WHEN プレイヤーがステージを完了した時 THEN システムは次のステージを解放し進行アニメーションを表示する
6. WHEN 8つのステージ全てが完了した時 THEN システムは特別な完走演出を表示する

### 要件3

**ユーザーストーリー:** プレイヤーとして、異なる特性を持つ車両タイプから選択したい。ゲームプレイ体験をカスタマイズするため。

#### 受け入れ基準

1. WHEN プレイヤーが車両選択に到達した時 THEN システムは3つの車両タイプ（スピード、バランス、スタミナ）を表示する
2. WHEN プレイヤーがスピードタイプを選択した時 THEN システムは高い基本速度だがミス時の大きな減速を提供する
3. WHEN プレイヤーがバランスタイプを選択した時 THEN システムは全指標で平均的な性能を提供する
4. WHEN プレイヤーがスタミナタイプを選択した時 THEN システムは低い基本速度だがミス時の小さな減速を提供する
5. WHEN プレイヤーが車両を選択した時 THEN システムは3Dプレビューと性能比較を表示する

### 要件4

**ユーザーストーリー:** プレイヤーとして、異なる時間帯の視覚的に区別される環境を運転したい。多様なゲーム体験を楽しむため。

#### 受け入れ基準

1. WHEN ステージ1-4をプレイする時 THEN システムは明るい昼間環境（海岸、砂漠、山道、市街地）を表示する
2. WHEN ステージ5-6をプレイする時 THEN システムはオレンジ色の夕日照明による美しい夕方環境を表示する
3. WHEN ステージ7-8をプレイする時 THEN システムはヘッドライトと街灯照明による夜間環境を表示する
4. WHEN 運転している時 THEN システムは適切な環境エフェクトを伴う3Dパースペクティブ道路ビューを表示する
5. WHEN 環境が変化する時 THEN システムは対応する視覚・音響エフェクトを適用する

### 要件5

**ユーザーストーリー:** 語学学習者として、運転中に翻訳問題に回答したい。タイピングと翻訳スキルを同時に向上させるため。

#### 受け入れ基準

1. WHEN 翻訳問題が出現した時 THEN システムは選択された元言語でソーステキストを表示する
2. WHEN プレイヤーが回答を入力する時 THEN システムは翻訳精度をリアルタイムで評価する（0-100%）
3. WHEN プレイヤーが正解を提供した時 THEN システムは車両を加速させポイントを付与する
4. WHEN プレイヤーがミスまたはタイムアウトした時 THEN システムは車両を減速させる
5. WHEN プレイヤーが連続で正解した時 THEN システムはコンボボーナスを適用する
6. IF 問題が難しい場合 THEN システムは代替表現と類義語を使用してヒントを提供する

### 要件6

**ユーザーストーリー:** 競争的なプレイヤーとして、スコアとランキングを見たい。進捗を追跡し他者と競争するため。

#### 受け入れ基準

1. WHEN プレイヤーがステージを完了した時 THEN システムは総合スコア（難易度×速度×コンボ×完走ボーナス）を計算・表示する
2. WHEN パフォーマンスを計算する時 THEN システムはWPM（Words Per Minute）、正答率、完走時間、最高コンボを追跡する
3. WHEN プレイヤーがランキングにアクセスした時 THEN システムはステージ、モード×難易度、翻訳方向、期間でフィルタされたランキングを表示する
4. WHEN プレイヤーがステージに失敗した時 THEN システムはスコアを挑戦前の状態にロールバックする
5. WHEN プレイヤーがステージを完了した時 THEN システムは成功時のみ記録を更新する
6. WHEN ランキングを表示する時 THEN システムは上位50名を表示しユーザー自身の記録をハイライトする

### 要件7

**ユーザーストーリー:** プレイヤーとして、モダンなWebブラウザでゲームがスムーズに動作してほしい。シームレスなゲームプレイ体験を楽しむため。

#### 受け入れ基準

1. WHEN ゲームが読み込まれる時 THEN システムは5秒以内に初期読み込みを完了する
2. WHEN ゲームをプレイする時 THEN システムは60 FPSのフレームレートを一貫して維持する
3. WHEN APIコールを行う時 THEN システムは200ms以内に応答する
4. WHEN ゲームが動作する時 THEN システムはChrome 90+、Firefox 88+、Safari 14+、Edge 90+と互換性がある
5. WHEN 3Dグラフィックスを使用する時 THEN システムはWebGL 2.0サポートを要求する
6. WHEN 異なるデバイスからアクセスする時 THEN システムはデスクトップとタブレットをサポートする（スマートフォンは除外）

### 要件8

**ユーザーストーリー:** ユーザーとして、データが安全でゲームがコスト効率的であってほしい。プライバシーの懸念や予期しない料金なしにプレイするため。

#### 受け入れ基準

1. WHEN ユーザーデータを扱う時 THEN システムは個人情報収集を最小化し転送時・保存時にデータを暗号化する
2. WHEN AWSで動作する時 THEN システムは$0コスト目標を維持するためFree Tier制限内で動作する
3. WHEN 不正行為を防ぐ時 THEN システムはスコア改ざん防止とゲームセッション整合性チェックを実装する
4. WHEN 入力を検証する時 THEN システムはGoバリデータと型安全性を使用して厳密な検証を実行する
5. WHEN 攻撃から保護する時 THEN システムはXSS、CSRF、クリックジャッキング保護を実装する
6. WHEN コストを監視する時 THEN システムは潜在的な料金に対する予算アラートとコスト監視を設定する

### 要件9

**ユーザーストーリー:** 開発者として、システムが保守可能でテスト可能であってほしい。コード品質と簡単な保守を確保するため。

#### 受け入れ基準

1. WHEN 機能を開発する時 THEN システムはRed-Green-Refactorサイクルでテスト駆動開発（TDD）手法に従う
2. WHEN コードを書く時 THEN システムはバックエンド（Go）の包括的単体テストとフロントエンド（Playwright）の統合テストを含む
3. WHEN デプロイする時 THEN システムはマルチアカウントAWS設定でInfrastructure as Code（Terraform）を使用する
4. WHEN 環境を管理する時 THEN システムは本番と開発アカウントを完全に分離する
5. WHEN CI/CDを構築する時 THEN システムはOIDC認証でGitHub Actionsを実装する（アクセスキーなし）
6. WHEN 開発環境を設定する時 THEN システムは一貫した開発設定のためDev Containersを使用する

### 要件10

**ユーザーストーリー:** コンテンツ管理者として、初期ゲームデータが自動生成・インポートされてほしい。十分なコンテンツでゲームを開始できるようにするため。

#### 受け入れ基準

1. WHEN 初期データを設定する時 THEN システムは600問題を生成する（単語/会話×easy/medium/hard各100個）
2. WHEN 翻訳を作成する時 THEN システムはAWS Translate APIを使用して日本語問題を英語に変換する
3. WHEN データをインポートする時 THEN システムは適切な検証でDynamoDBに全問題をバッチインポートする
4. WHEN 翻訳品質を管理する時 THEN システムはヒント機能のため代替表現と類義語を含む
5. WHEN データを保守する時 THEN システムは定期的な問題追加と品質改善のためのスクリプトを提供する